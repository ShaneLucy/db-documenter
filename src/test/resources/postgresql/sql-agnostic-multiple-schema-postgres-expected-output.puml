@startuml
hide methods
hide stereotypes

package "ecommerce" {
	entity "users" {
		**user_id: bigint**
		--
		username: character varying(50) <<UNIQUE>>
		email: character varying(255) <<UNIQUE,CHECK>>
		password_hash: character varying(255)
		first_name: character varying(100) <<NULLABLE>>
		last_name: character varying(100) <<NULLABLE>>
		date_of_birth: date <<NULLABLE>>
		phone_number: character varying(20) <<NULLABLE>>
		is_active: boolean <<DEFAULT>>
		is_verified: boolean <<DEFAULT>>
		created_at: timestamp without time zone
		updated_at: timestamp without time zone <<NULLABLE>>
		last_login_at: timestamp without time zone <<NULLABLE>>
		credit_balance: numeric <<DEFAULT,CHECK,NULLABLE>>
		loyalty_points: integer <<DEFAULT,NULLABLE>>
		bio: text <<NULLABLE>>
	}

	entity "user_referrals" {
		**referrer_user_id: bigint** <<FK,CHECK>>
		**referred_user_id: bigint** <<FK,CHECK>>
		--
		referral_date: timestamp without time zone
		referral_bonus: numeric <<DEFAULT,NULLABLE>>
		status: character varying(20) <<DEFAULT,CHECK>>
	}

	entity "addresses" {
		**address_id: bigint**
		--
		user_id: bigint <<FK>>
		address_type: character varying(20) <<CHECK>>
		street_line1: character varying(200)
		street_line2: character varying(200) <<NULLABLE>>
		city: character varying(100)
		state_province: character varying(100) <<NULLABLE>>
		postal_code: character varying(20) <<NULLABLE>>
		country_code: character(2) <<CHECK>>
		is_default: boolean <<DEFAULT,NULLABLE>>
		created_at: timestamp without time zone
	}

	entity "categories" {
		**category_id: integer**
		--
		category_name: character varying(100) <<UNIQUE>>
		parent_category_id: integer <<FK,NULLABLE>>
		description: text <<NULLABLE>>
		display_order: integer <<DEFAULT,NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
	}

	entity "products" {
		**product_id: bigint**
		--
		sku: character varying(50) <<UNIQUE>>
		product_name: character varying(200)
		description: text <<NULLABLE>>
		category_id: integer <<FK,NULLABLE>>
		unit_price: numeric <<CHECK>>
		cost_price: numeric <<NULLABLE>>
		weight_kg: numeric <<NULLABLE>>
		dimensions_cm: character varying(50) <<NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
		is_featured: boolean <<DEFAULT,NULLABLE>>
		stock_quantity: integer <<DEFAULT,CHECK,NULLABLE>>
		reorder_level: integer <<DEFAULT,NULLABLE>>
		created_at: timestamp without time zone
		updated_at: timestamp without time zone <<NULLABLE>>
	}

	entity "product_images" {
		**product_id: bigint** <<FK>>
		**image_sequence: integer**
		--
		image_url: character varying(500)
		alt_text: character varying(200) <<NULLABLE>>
		is_primary: boolean <<DEFAULT,NULLABLE>>
		uploaded_at: timestamp without time zone
	}

	entity "product_reviews" {
		**product_id: bigint** <<FK>>
		**user_id: bigint** <<FK>>
		--
		rating: smallint <<CHECK>>
		review_title: character varying(200) <<NULLABLE>>
		review_text: text <<NULLABLE>>
		is_verified_purchase: boolean <<DEFAULT,NULLABLE>>
		helpful_count: integer <<DEFAULT,NULLABLE>>
		created_at: timestamp without time zone
		updated_at: timestamp without time zone <<NULLABLE>>
	}

	entity "orders" {
		**order_id: bigint**
		--
		order_number: character varying(50) <<UNIQUE>>
		user_id: bigint <<FK>>
		order_status: character varying(20) <<DEFAULT,CHECK>>
		order_date: timestamp without time zone
		shipped_date: timestamp without time zone <<NULLABLE>>
		delivered_date: timestamp without time zone <<NULLABLE>>
		shipping_address_id: bigint <<FK,NULLABLE>>
		billing_address_id: bigint <<FK,NULLABLE>>
		subtotal: numeric
		tax_amount: numeric <<DEFAULT,NULLABLE>>
		shipping_cost: numeric <<DEFAULT,NULLABLE>>
		discount_amount: numeric <<DEFAULT,NULLABLE>>
		total_amount: numeric <<CHECK>>
		notes: text <<NULLABLE>>
	}

	entity "order_items" {
		**order_id: bigint** <<FK>>
		**line_number: integer**
		--
		product_id: bigint <<FK>>
		product_name: character varying(200)
		quantity: integer <<CHECK>>
		unit_price: numeric
		discount_percent: numeric <<DEFAULT,CHECK,NULLABLE>>
		line_total: numeric
	}

	entity "payments" {
		**payment_id: bigint**
		--
		order_id: bigint <<FK>>
		payment_method: character varying(50)
		payment_status: character varying(20) <<DEFAULT,CHECK>>
		amount: numeric <<CHECK>>
		currency_code: character(3) <<DEFAULT,CHECK,NULLABLE>>
		transaction_id: character varying(100) <<NULLABLE>>
		payment_date: timestamp without time zone <<NULLABLE>>
		confirmed_date: timestamp without time zone <<NULLABLE>>
		notes: text <<NULLABLE>>
	}

	entity "coupons" {
		**coupon_id: integer**
		--
		coupon_code: character varying(50) <<UNIQUE>>
		description: character varying(200) <<NULLABLE>>
		discount_type: character varying(20) <<CHECK>>
		discount_value: numeric <<CHECK>>
		min_purchase_amount: numeric <<NULLABLE>>
		max_discount_amount: numeric <<NULLABLE>>
		valid_from: timestamp without time zone
		valid_until: timestamp without time zone
		usage_limit: integer <<NULLABLE>>
		times_used: integer <<DEFAULT,NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
	}

	entity "coupon_usage" {
		**coupon_id: integer** <<FK>>
		**order_id: bigint** <<FK>>
		--
		user_id: bigint <<FK>>
		discount_applied: numeric
		used_at: timestamp without time zone
	}

}

package "inventory" {
	entity "warehouses" {
		**warehouse_id: integer**
		--
		warehouse_code: character varying(20) <<UNIQUE>>
		warehouse_name: character varying(100)
		manager_name: character varying(100) <<NULLABLE>>
		address_line1: character varying(200)
		address_line2: character varying(200) <<NULLABLE>>
		city: character varying(100)
		state_province: character varying(100) <<NULLABLE>>
		postal_code: character varying(20) <<NULLABLE>>
		country_code: character(2)
		phone_number: character varying(20) <<NULLABLE>>
		email: character varying(100) <<NULLABLE>>
		capacity_sqm: numeric <<CHECK,NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
		opened_date: date <<NULLABLE>>
	}

	entity "suppliers" {
		**supplier_id: integer**
		--
		supplier_code: character varying(20) <<UNIQUE>>
		supplier_name: character varying(200)
		contact_name: character varying(100) <<NULLABLE>>
		contact_email: character varying(100) <<NULLABLE>>
		contact_phone: character varying(20) <<NULLABLE>>
		address_line1: character varying(200) <<NULLABLE>>
		address_line2: character varying(200) <<NULLABLE>>
		city: character varying(100) <<NULLABLE>>
		country_code: character(2) <<NULLABLE>>
		payment_terms: character varying(50) <<NULLABLE>>
		credit_limit: numeric <<NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
		rating: smallint <<CHECK,NULLABLE>>
		created_at: timestamp without time zone
	}

	entity "product_suppliers" {
		**product_id: bigint** <<FK>>
		**supplier_id: integer** <<FK>>
		--
		supplier_sku: character varying(50) <<NULLABLE>>
		unit_cost: numeric <<CHECK>>
		lead_time_days: integer <<CHECK,NULLABLE>>
		min_order_quantity: integer <<DEFAULT,NULLABLE>>
		is_preferred: boolean <<DEFAULT,NULLABLE>>
		effective_from: date
		effective_until: date <<NULLABLE>>
	}

	entity "stock_levels" {
		**product_id: bigint** <<FK>>
		**warehouse_id: integer** <<FK>>
		--
		quantity_on_hand: integer <<DEFAULT,CHECK>>
		quantity_reserved: integer <<DEFAULT,CHECK>>
		quantity_available: integer <<DEFAULT>>
		reorder_point: integer <<DEFAULT,NULLABLE>>
		max_stock_level: integer <<NULLABLE>>
		last_stock_check: timestamp without time zone <<NULLABLE>>
		last_restocked_at: timestamp without time zone <<NULLABLE>>
	}

	entity "purchase_orders" {
		**po_id: bigint**
		--
		po_number: character varying(50) <<UNIQUE>>
		supplier_id: integer <<FK>>
		warehouse_id: integer <<FK>>
		order_date: date
		expected_delivery_date: date <<NULLABLE>>
		actual_delivery_date: date <<NULLABLE>>
		status: character varying(20) <<DEFAULT,CHECK>>
		subtotal: numeric
		tax_amount: numeric <<DEFAULT,NULLABLE>>
		shipping_cost: numeric <<DEFAULT,NULLABLE>>
		total_amount: numeric <<CHECK>>
		notes: text <<NULLABLE>>
		created_by: character varying(100) <<NULLABLE>>
	}

	entity "purchase_order_items" {
		**po_id: bigint** <<FK>>
		**line_number: integer**
		--
		product_id: bigint <<FK>>
		quantity_ordered: integer <<CHECK>>
		quantity_received: integer <<DEFAULT,CHECK,NULLABLE>>
		unit_cost: numeric
		line_total: numeric
		received_date: date <<NULLABLE>>
	}

	entity "stock_movements" {
		**movement_id: bigint**
		--
		product_id: bigint <<FK>>
		warehouse_id: integer <<FK>>
		movement_type: character varying(20) <<CHECK>>
		quantity: integer
		reference_type: character varying(50) <<NULLABLE>>
		reference_id: bigint <<NULLABLE>>
		movement_date: timestamp without time zone
		performed_by: character varying(100) <<NULLABLE>>
		notes: text <<NULLABLE>>
	}

	entity "warehouse_transfers" {
		**transfer_id: bigint**
		**product_id: bigint** <<FK>>
		--
		from_warehouse_id: integer <<FK,CHECK>>
		to_warehouse_id: integer <<FK,CHECK>>
		quantity: integer <<CHECK>>
		transfer_date: timestamp without time zone
		received_date: timestamp without time zone <<NULLABLE>>
		status: character varying(20) <<DEFAULT,CHECK,NULLABLE>>
		initiated_by: character varying(100) <<NULLABLE>>
		notes: text <<NULLABLE>>
	}

}

package "analytics" {
	entity "daily_sales" {
		**report_date: date**
		--
		total_orders: integer <<DEFAULT,NULLABLE>>
		total_revenue: numeric <<DEFAULT,NULLABLE>>
		total_items_sold: integer <<DEFAULT,NULLABLE>>
		unique_customers: integer <<DEFAULT,NULLABLE>>
		average_order_value: numeric <<DEFAULT,NULLABLE>>
		new_customers: integer <<DEFAULT,NULLABLE>>
		returning_customers: integer <<DEFAULT,NULLABLE>>
		cancelled_orders: integer <<DEFAULT,NULLABLE>>
		refunded_amount: numeric <<DEFAULT,NULLABLE>>
		generated_at: timestamp without time zone
	}

	entity "product_performance" {
		**report_date: date**
		**product_id: bigint** <<FK>>
		--
		units_sold: integer <<DEFAULT,NULLABLE>>
		revenue: numeric <<DEFAULT,NULLABLE>>
		cost: numeric <<DEFAULT,NULLABLE>>
		profit: numeric <<DEFAULT,NULLABLE>>
		profit_margin: numeric <<DEFAULT,NULLABLE>>
		page_views: integer <<DEFAULT,NULLABLE>>
		conversion_rate: numeric <<DEFAULT,NULLABLE>>
		average_rating: numeric <<NULLABLE>>
		review_count: integer <<DEFAULT,NULLABLE>>
	}

	entity "customer_segments" {
		**segment_id: integer**
		--
		segment_name: character varying(50) <<UNIQUE>>
		description: text <<NULLABLE>>
		min_lifetime_value: numeric <<NULLABLE>>
		max_lifetime_value: numeric <<NULLABLE>>
		min_order_count: integer <<NULLABLE>>
		max_order_count: integer <<NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
	}

	entity "customer_segment_history" {
		**user_id: bigint** <<FK>>
		**segment_id: integer** <<FK>>
		**assigned_date: date**
		--
		lifetime_value: numeric <<NULLABLE>>
		order_count: integer <<NULLABLE>>
		last_order_date: date <<NULLABLE>>
	}

	entity "inventory_turnover" {
		**report_month: date**
		**product_id: bigint** <<FK>>
		**warehouse_id: integer** <<FK>>
		--
		beginning_inventory: integer <<NULLABLE>>
		ending_inventory: integer <<NULLABLE>>
		units_sold: integer <<NULLABLE>>
		units_purchased: integer <<NULLABLE>>
		average_inventory: numeric <<NULLABLE>>
		turnover_ratio: numeric <<NULLABLE>>
		days_of_inventory: numeric <<NULLABLE>>
	}

	entity "supplier_performance" {
		**report_quarter: date**
		**supplier_id: integer** <<FK>>
		--
		total_orders: integer <<DEFAULT,NULLABLE>>
		on_time_deliveries: integer <<DEFAULT,NULLABLE>>
		late_deliveries: integer <<DEFAULT,NULLABLE>>
		total_amount: numeric <<DEFAULT,NULLABLE>>
		average_lead_time_days: numeric <<NULLABLE>>
		quality_score: numeric <<CHECK,NULLABLE>>
	}

	entity "campaigns" {
		**campaign_id: integer**
		--
		campaign_name: character varying(100)
		campaign_type: character varying(50) <<NULLABLE>>
		start_date: date
		end_date: date <<NULLABLE>>
		budget: numeric <<NULLABLE>>
		actual_spend: numeric <<DEFAULT,NULLABLE>>
		target_audience: character varying(100) <<NULLABLE>>
		is_active: boolean <<DEFAULT,NULLABLE>>
	}

	entity "campaign_performance" {
		**campaign_id: integer** <<FK>>
		**report_date: date**
		--
		impressions: integer <<DEFAULT,NULLABLE>>
		clicks: integer <<DEFAULT,NULLABLE>>
		conversions: integer <<DEFAULT,NULLABLE>>
		revenue: numeric <<DEFAULT,NULLABLE>>
		cost: numeric <<DEFAULT,NULLABLE>>
		click_through_rate: numeric <<NULLABLE>>
		conversion_rate: numeric <<NULLABLE>>
		return_on_ad_spend: numeric <<NULLABLE>>
	}

}

addresses ||--o{ orders
addresses ||--o{ orders

categories ||--o{ categories
categories ||--o{ products

coupons ||--|{ coupon_usage

orders ||--|{ order_items
orders ||--|{ payments
orders ||--|{ coupon_usage

products ||--|{ product_images
products ||--|{ product_reviews
products ||--|{ order_items

users ||--|{ user_referrals
users ||--|{ user_referrals
users ||--|{ addresses
users ||--|{ product_reviews
users ||--|{ orders
users ||--|{ coupon_usage

ecommerce.products ||--|{ inventory.product_suppliers
ecommerce.products ||--|{ inventory.stock_levels
ecommerce.products ||--|{ inventory.purchase_order_items
ecommerce.products ||--|{ inventory.stock_movements
ecommerce.products ||--|{ inventory.warehouse_transfers

purchase_orders ||--|{ purchase_order_items

suppliers ||--|{ product_suppliers
suppliers ||--|{ purchase_orders

warehouses ||--|{ stock_levels
warehouses ||--|{ purchase_orders
warehouses ||--|{ stock_movements
warehouses ||--|{ warehouse_transfers
warehouses ||--|{ warehouse_transfers

campaigns ||--|{ campaign_performance

customer_segments ||--|{ customer_segment_history

ecommerce.products ||--|{ analytics.product_performance
ecommerce.products ||--|{ analytics.inventory_turnover

inventory.suppliers ||--|{ analytics.supplier_performance

ecommerce.users ||--|{ analytics.customer_segment_history

inventory.warehouses ||--|{ analytics.inventory_turnover

@enduml
