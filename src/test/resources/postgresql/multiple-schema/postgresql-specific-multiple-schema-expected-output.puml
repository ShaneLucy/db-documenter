@startuml
hide methods
hide stereotypes

package "auth" {
	entity "account_status" <<enum>> {
		pending_verification
		active
		suspended
		deactivated
		locked
	}

	entity "mfa_method" <<enum>> {
		totp
		sms
		email
		hardware_key
		backup_codes
	}

	entity "users" {
		**id: uuid** <<DEFAULT>>
		--
		email: character varying(255) <<UNIQUE,CHECK>>
		email_verified: boolean <<DEFAULT>>
		email_verified_at: timestamp with time zone <<NULLABLE>>
		username: character varying(50) <<UNIQUE,CHECK,NULLABLE>>
		password_hash: character varying(255) <<CHECK>>
		password_changed_at: timestamp with time zone <<DEFAULT>>
		profile: jsonb <<DEFAULT>>
		preferred_languages: ARRAY <<DEFAULT>>
		status: account_status <<DEFAULT>>
		search_vector: tsvector <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
		last_login_at: timestamp with time zone <<NULLABLE>>
		login_count: integer <<DEFAULT>>
		failed_login_count: integer <<DEFAULT>>
		locked_until: timestamp with time zone <<NULLABLE>>
	}

	entity "user_mfa" {
		**id: uuid** <<DEFAULT>>
		--
		user_id: uuid <<FK,UNIQUE>>
		method: mfa_method
		secret_encrypted: bytea <<NULLABLE>>
		backup_codes: ARRAY <<NULLABLE>>
		is_primary: boolean <<UNIQUE,DEFAULT>>
		is_verified: boolean <<DEFAULT>>
		verified_at: timestamp with time zone <<NULLABLE>>
		metadata: jsonb <<DEFAULT>>
		created_at: timestamp with time zone <<DEFAULT>>
		last_used_at: timestamp with time zone <<NULLABLE>>
	}

	entity "roles" {
		**id: integer** <<AUTO_INCREMENT,DEFAULT>>
		--
		code: character varying(50) <<UNIQUE>>
		name: character varying(100)
		description: text <<NULLABLE>>
		parent_role_id: integer <<FK,NULLABLE>>
		is_system_role: boolean <<DEFAULT>>
		settings: jsonb <<DEFAULT>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
	}

	entity "permissions" {
		**id: integer** <<AUTO_INCREMENT,DEFAULT>>
		--
		code: character varying(100) <<UNIQUE>>
		name: character varying(200)
		description: text <<NULLABLE>>
		categories: ARRAY <<DEFAULT>>
		resource: character varying(50) <<UNIQUE>>
		action: character varying(50) <<UNIQUE>>
		created_at: timestamp with time zone <<DEFAULT>>
	}

	entity "role_permissions" {
		**role_id: integer** <<FK>>
		**permission_id: integer** <<FK>>
		--
		conditions: jsonb <<NULLABLE>>
		granted_at: timestamp with time zone <<DEFAULT>>
		granted_by: uuid <<FK,NULLABLE>>
	}

	entity "user_roles" {
		**user_id: uuid** <<FK>>
		**role_id: integer** <<FK>>
		**organization_id_key: uuid** <<GENERATED>>
		--
		organization_id: uuid <<FK,NULLABLE>>
		valid_from: timestamp with time zone <<DEFAULT,CHECK>>
		valid_until: timestamp with time zone <<CHECK,NULLABLE>>
		assigned_at: timestamp with time zone <<DEFAULT>>
		assigned_by: uuid <<FK,NULLABLE>>
	}

	entity "sessions" {
		**id: uuid** <<DEFAULT>>
		--
		user_id: uuid <<FK>>
		token_hash: character varying(64) <<UNIQUE>>
		metadata: jsonb <<DEFAULT>>
		created_at: timestamp with time zone <<DEFAULT,CHECK>>
		expires_at: timestamp with time zone <<CHECK>>
		last_activity: timestamp with time zone <<DEFAULT>>
		revoked_at: timestamp with time zone <<NULLABLE>>
		revoked_reason: character varying(100) <<NULLABLE>>
	}

}

package "core" {
	entity "priority_level" <<enum>> {
		critical
		high
		medium
		low
		none
	}

	entity "project_status" <<enum>> {
		planning
		active
		on_hold
		completed
		archived
		cancelled
	}

	entity "subscription_tier" <<enum>> {
		free
		starter
		professional
		enterprise
		custom
	}

	entity "task_status" <<enum>> {
		backlog
		todo
		in_progress
		in_review
		blocked
		done
		cancelled
	}

	entity "address_type" <<composite>> {
		street_line1 : character varying(200)
		street_line2 : character varying(200)
		city : character varying(100)
		state_province : character varying(100)
		postal_code : character varying(20)
		country_code : character(2)
	}

	entity "money_amount" <<composite>> {
		amount : numeric(19,4)
		currency_code : character(3)
	}

	entity "time_slot" <<composite>> {
		start_time : timestamp with time zone
		end_time : timestamp with time zone
	}

	entity "organizations" {
		**id: uuid** <<DEFAULT>>
		--
		name: character varying(200)
		slug: character varying(100) <<UNIQUE,CHECK>>
		billing_address: core.address_type <<NULLABLE>>
		subscription_tier: subscription_tier <<DEFAULT>>
		subscription_data: jsonb <<DEFAULT>>
		settings: jsonb <<DEFAULT>>
		allowed_domains: ARRAY <<DEFAULT>>
		search_vector: tsvector <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
		created_by: uuid <<FK,NULLABLE>>
		deleted_at: timestamp with time zone <<NULLABLE>>
	}

	entity "organization_members" {
		**organization_id: uuid** <<FK>>
		**user_id: uuid** <<FK>>
		--
		display_name: character varying(100) <<NULLABLE>>
		role: character varying(50) <<DEFAULT>>
		permissions_override: jsonb <<NULLABLE>>
		invited_at: timestamp with time zone <<DEFAULT>>
		invited_by: uuid <<FK,NULLABLE>>
		accepted_at: timestamp with time zone <<NULLABLE>>
		is_active: boolean <<DEFAULT>>
	}

	entity "projects" {
		**id: uuid** <<DEFAULT>>
		--
		organization_id: uuid <<FK,UNIQUE>>
		key: character varying(10) <<UNIQUE>>
		name: character varying(200)
		description: text <<NULLABLE>>
		status: project_status <<DEFAULT>>
		lead_id: uuid <<FK,NULLABLE>>
		start_date: date <<CHECK,NULLABLE>>
		target_end_date: date <<CHECK,NULLABLE>>
		actual_end_date: date <<CHECK,NULLABLE>>
		tags: ARRAY <<DEFAULT>>
		color: character(7) <<DEFAULT,CHECK,NULLABLE>>
		custom_fields: jsonb <<DEFAULT>>
		settings: jsonb <<DEFAULT>>
		search_vector: tsvector <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
		created_by: uuid <<FK,NULLABLE>>
		archived_at: timestamp with time zone <<NULLABLE>>
	}

	entity "tasks" {
		**id: uuid** <<DEFAULT>>
		--
		project_id: uuid <<FK,UNIQUE>>
		task_number: integer <<UNIQUE>>
		title: character varying(500)
		description: text <<NULLABLE>>
		status: task_status <<DEFAULT,CHECK>>
		priority: priority_level <<DEFAULT>>
		assignee_ids: ARRAY <<DEFAULT>>
		reporter_id: uuid <<FK,NULLABLE>>
		parent_task_id: uuid <<FK,NULLABLE>>
		path: ARRAY <<DEFAULT>>
		depth: integer <<DEFAULT>>
		due_date: timestamp with time zone <<NULLABLE>>
		started_at: timestamp with time zone <<NULLABLE>>
		completed_at: timestamp with time zone <<CHECK,NULLABLE>>
		estimated_minutes: integer <<CHECK,NULLABLE>>
		logged_minutes: integer <<DEFAULT,CHECK>>
		remaining_minutes: integer <<NULLABLE,GENERATED>>
		story_points: smallint <<CHECK,NULLABLE>>
		labels: ARRAY <<DEFAULT>>
		custom_fields: jsonb <<DEFAULT>>
		search_vector: tsvector <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
		created_by: uuid <<FK,NULLABLE>>
	}

	entity "task_dependencies" {
		**predecessor_id: uuid** <<FK,CHECK>>
		**successor_id: uuid** <<FK,CHECK>>
		--
		dependency_type: character varying(20) <<DEFAULT,CHECK>>
		lag_days: integer <<DEFAULT>>
		created_at: timestamp with time zone <<DEFAULT>>
		created_by: uuid <<FK,NULLABLE>>
	}

	entity "time_entries" {
		**id: uuid** <<DEFAULT>>
		--
		task_id: uuid <<FK>>
		user_id: uuid <<FK>>
		started_at: timestamp with time zone <<CHECK>>
		ended_at: timestamp with time zone <<CHECK,NULLABLE>>
		duration_minutes: integer <<NULLABLE,GENERATED>>
		description: text <<NULLABLE>>
		is_billable: boolean <<DEFAULT>>
		billing_rate: core.money_amount <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
	}

	entity "resource_bookings" {
		**id: uuid** <<DEFAULT>>
		--
		resource_type: character varying(50)
		resource_id: uuid
		booked_by: uuid <<FK>>
		organization_id: uuid <<FK>>
		booking_start: timestamp with time zone <<CHECK>>
		booking_end: timestamp with time zone <<CHECK>>
		booking_range: tstzrange <<NULLABLE,GENERATED>>
		title: character varying(200)
		description: text <<NULLABLE>>
		recurrence: jsonb <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
	}

	entity "comments" {
		**id: uuid** <<DEFAULT>>
		--
		entity_type: character varying(50) <<CHECK>>
		entity_id: uuid
		content: text <<CHECK>>
		content_html: text <<NULLABLE>>
		search_vector: tsvector <<NULLABLE>>
		parent_id: uuid <<FK,NULLABLE>>
		mentioned_user_ids: ARRAY <<DEFAULT>>
		reactions: jsonb <<DEFAULT>>
		author_id: uuid <<FK>>
		is_edited: boolean <<DEFAULT>>
		edited_at: timestamp with time zone <<NULLABLE>>
		created_at: timestamp with time zone <<DEFAULT>>
		updated_at: timestamp with time zone <<DEFAULT>>
		deleted_at: timestamp with time zone <<NULLABLE>>
	}

	entity "active_organization_members_view" {
		organization_id: uuid <<NULLABLE>>
		user_id: uuid <<NULLABLE>>
		member_role: character varying(50) <<NULLABLE>>
		display_name: character varying <<NULLABLE>>
		email: character varying(255) <<NULLABLE>>
		avatar_url: jsonb <<NULLABLE>>
		account_status: auth.account_status <<NULLABLE>>
		accepted_at: timestamp with time zone <<NULLABLE>>
		last_login_at: timestamp with time zone <<NULLABLE>>
	}

	entity "project_summary_view" {
		id: uuid <<NULLABLE>>
		organization_id: uuid <<NULLABLE>>
		key: character varying(10) <<NULLABLE>>
		name: character varying(200) <<NULLABLE>>
		status: project_status <<NULLABLE>>
		lead_id: uuid <<NULLABLE>>
		lead_email: character varying(255) <<NULLABLE>>
		total_tasks: bigint <<NULLABLE>>
		completed_tasks: bigint <<NULLABLE>>
		active_tasks: bigint <<NULLABLE>>
		overdue_tasks: bigint <<NULLABLE>>
		start_date: date <<NULLABLE>>
		target_end_date: date <<NULLABLE>>
		created_at: timestamp with time zone <<NULLABLE>>
		updated_at: timestamp with time zone <<NULLABLE>>
	}

	entity "user_task_workload_view" {
		user_id: uuid <<NULLABLE>>
		email: character varying(255) <<NULLABLE>>
		username: character varying(50) <<NULLABLE>>
		total_assigned_tasks: bigint <<NULLABLE>>
		active_tasks: bigint <<NULLABLE>>
		blocked_tasks: bigint <<NULLABLE>>
		overdue_tasks: bigint <<NULLABLE>>
		remaining_estimated_minutes: bigint <<NULLABLE>>
		remaining_story_points: bigint <<NULLABLE>>
		project_ids: ARRAY <<NULLABLE>>
	}

}

package "analytics" {
	entity "daily_project_stats" {
		**stat_date: date**
		**project_id: uuid**
		--
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		organization_id: uuid
		tasks_backlog: integer <<DEFAULT>>
		tasks_todo: integer <<DEFAULT>>
		tasks_in_progress: integer <<DEFAULT>>
		tasks_in_review: integer <<DEFAULT>>
		tasks_blocked: integer <<DEFAULT>>
		tasks_done: integer <<DEFAULT>>
		tasks_cancelled: integer <<DEFAULT>>
		tasks_total: integer <<DEFAULT>>
		tasks_completed_pct: numeric <<NULLABLE>>
		story_points_total: integer <<NULLABLE>>
		story_points_completed: integer <<NULLABLE>>
		estimated_minutes: bigint <<NULLABLE>>
		logged_minutes: bigint <<NULLABLE>>
		active_member_count: integer <<DEFAULT>>
		active_member_ids: ARRAY <<DEFAULT>>
		computed_at: timestamp with time zone <<DEFAULT>>
	}

	entity "daily_project_stats_2024_q4" {
		**stat_date: date**
		**project_id: uuid**
		--
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		organization_id: uuid
		tasks_backlog: integer <<DEFAULT>>
		tasks_todo: integer <<DEFAULT>>
		tasks_in_progress: integer <<DEFAULT>>
		tasks_in_review: integer <<DEFAULT>>
		tasks_blocked: integer <<DEFAULT>>
		tasks_done: integer <<DEFAULT>>
		tasks_cancelled: integer <<DEFAULT>>
		tasks_total: integer <<DEFAULT>>
		tasks_completed_pct: numeric <<NULLABLE>>
		story_points_total: integer <<NULLABLE>>
		story_points_completed: integer <<NULLABLE>>
		estimated_minutes: bigint <<NULLABLE>>
		logged_minutes: bigint <<NULLABLE>>
		active_member_count: integer <<DEFAULT>>
		active_member_ids: ARRAY <<DEFAULT>>
		computed_at: timestamp with time zone <<DEFAULT>>
	}

	entity "daily_project_stats_2025_q1" {
		**stat_date: date**
		**project_id: uuid**
		--
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		organization_id: uuid
		tasks_backlog: integer <<DEFAULT>>
		tasks_todo: integer <<DEFAULT>>
		tasks_in_progress: integer <<DEFAULT>>
		tasks_in_review: integer <<DEFAULT>>
		tasks_blocked: integer <<DEFAULT>>
		tasks_done: integer <<DEFAULT>>
		tasks_cancelled: integer <<DEFAULT>>
		tasks_total: integer <<DEFAULT>>
		tasks_completed_pct: numeric <<NULLABLE>>
		story_points_total: integer <<NULLABLE>>
		story_points_completed: integer <<NULLABLE>>
		estimated_minutes: bigint <<NULLABLE>>
		logged_minutes: bigint <<NULLABLE>>
		active_member_count: integer <<DEFAULT>>
		active_member_ids: ARRAY <<DEFAULT>>
		computed_at: timestamp with time zone <<DEFAULT>>
	}

	entity "daily_project_stats_2025_q2" {
		**stat_date: date**
		**project_id: uuid**
		--
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		organization_id: uuid
		tasks_backlog: integer <<DEFAULT>>
		tasks_todo: integer <<DEFAULT>>
		tasks_in_progress: integer <<DEFAULT>>
		tasks_in_review: integer <<DEFAULT>>
		tasks_blocked: integer <<DEFAULT>>
		tasks_done: integer <<DEFAULT>>
		tasks_cancelled: integer <<DEFAULT>>
		tasks_total: integer <<DEFAULT>>
		tasks_completed_pct: numeric <<NULLABLE>>
		story_points_total: integer <<NULLABLE>>
		story_points_completed: integer <<NULLABLE>>
		estimated_minutes: bigint <<NULLABLE>>
		logged_minutes: bigint <<NULLABLE>>
		active_member_count: integer <<DEFAULT>>
		active_member_ids: ARRAY <<DEFAULT>>
		computed_at: timestamp with time zone <<DEFAULT>>
	}

	entity "daily_project_stats_default" {
		**stat_date: date**
		**project_id: uuid**
		--
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		organization_id: uuid
		tasks_backlog: integer <<DEFAULT>>
		tasks_todo: integer <<DEFAULT>>
		tasks_in_progress: integer <<DEFAULT>>
		tasks_in_review: integer <<DEFAULT>>
		tasks_blocked: integer <<DEFAULT>>
		tasks_done: integer <<DEFAULT>>
		tasks_cancelled: integer <<DEFAULT>>
		tasks_total: integer <<DEFAULT>>
		tasks_completed_pct: numeric <<NULLABLE>>
		story_points_total: integer <<NULLABLE>>
		story_points_completed: integer <<NULLABLE>>
		estimated_minutes: bigint <<NULLABLE>>
		logged_minutes: bigint <<NULLABLE>>
		active_member_count: integer <<DEFAULT>>
		active_member_ids: ARRAY <<DEFAULT>>
		computed_at: timestamp with time zone <<DEFAULT>>
	}

	entity "user_activity_summary" {
		**user_id: uuid** <<FK>>
		**period_start: date**
		**period_type: character varying(10)**
		--
		tasks_created: integer <<DEFAULT>>
		tasks_completed: integer <<DEFAULT>>
		comments_posted: integer <<DEFAULT>>
		time_entries_count: integer <<DEFAULT>>
		minutes_logged: integer <<DEFAULT>>
		active_project_ids: ARRAY <<DEFAULT>>
		activity_breakdown: jsonb <<DEFAULT>>
		computed_at: timestamp with time zone <<DEFAULT>>
	}

}

package "audit" {
	entity "action_type" <<enum>> {
		create
		read
		update
		delete
		login
		logout
		permission_change
		export
		bulk_operation
	}

	entity "audit_log" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		**event_time: timestamp with time zone** <<DEFAULT>>
		--
		user_id: uuid <<NULLABLE>>
		session_id: uuid <<NULLABLE>>
		ip_address: inet <<NULLABLE>>
		user_agent: text <<NULLABLE>>
		organization_id: uuid <<NULLABLE>>
		action: action_type
		entity_type: character varying(100)
		entity_id: text
		old_values: jsonb <<NULLABLE>>
		new_values: jsonb <<NULLABLE>>
		changed_fields: ARRAY <<DEFAULT>>
		context: jsonb <<DEFAULT>>
		request_id: uuid <<NULLABLE>>
		correlation_id: uuid <<NULLABLE>>
	}

	entity "audit_log_2024_11" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		**event_time: timestamp with time zone** <<DEFAULT>>
		--
		user_id: uuid <<NULLABLE>>
		session_id: uuid <<NULLABLE>>
		ip_address: inet <<NULLABLE>>
		user_agent: text <<NULLABLE>>
		organization_id: uuid <<NULLABLE>>
		action: action_type
		entity_type: character varying(100)
		entity_id: text
		old_values: jsonb <<NULLABLE>>
		new_values: jsonb <<NULLABLE>>
		changed_fields: ARRAY <<DEFAULT>>
		context: jsonb <<DEFAULT>>
		request_id: uuid <<NULLABLE>>
		correlation_id: uuid <<NULLABLE>>
	}

	entity "audit_log_2024_12" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		**event_time: timestamp with time zone** <<DEFAULT>>
		--
		user_id: uuid <<NULLABLE>>
		session_id: uuid <<NULLABLE>>
		ip_address: inet <<NULLABLE>>
		user_agent: text <<NULLABLE>>
		organization_id: uuid <<NULLABLE>>
		action: action_type
		entity_type: character varying(100)
		entity_id: text
		old_values: jsonb <<NULLABLE>>
		new_values: jsonb <<NULLABLE>>
		changed_fields: ARRAY <<DEFAULT>>
		context: jsonb <<DEFAULT>>
		request_id: uuid <<NULLABLE>>
		correlation_id: uuid <<NULLABLE>>
	}

	entity "audit_log_2025_01" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		**event_time: timestamp with time zone** <<DEFAULT>>
		--
		user_id: uuid <<NULLABLE>>
		session_id: uuid <<NULLABLE>>
		ip_address: inet <<NULLABLE>>
		user_agent: text <<NULLABLE>>
		organization_id: uuid <<NULLABLE>>
		action: action_type
		entity_type: character varying(100)
		entity_id: text
		old_values: jsonb <<NULLABLE>>
		new_values: jsonb <<NULLABLE>>
		changed_fields: ARRAY <<DEFAULT>>
		context: jsonb <<DEFAULT>>
		request_id: uuid <<NULLABLE>>
		correlation_id: uuid <<NULLABLE>>
	}

	entity "audit_log_default" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		**event_time: timestamp with time zone** <<DEFAULT>>
		--
		user_id: uuid <<NULLABLE>>
		session_id: uuid <<NULLABLE>>
		ip_address: inet <<NULLABLE>>
		user_agent: text <<NULLABLE>>
		organization_id: uuid <<NULLABLE>>
		action: action_type
		entity_type: character varying(100)
		entity_id: text
		old_values: jsonb <<NULLABLE>>
		new_values: jsonb <<NULLABLE>>
		changed_fields: ARRAY <<DEFAULT>>
		context: jsonb <<DEFAULT>>
		request_id: uuid <<NULLABLE>>
		correlation_id: uuid <<NULLABLE>>
	}

	entity "entity_changes" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		--
		entity_type: character varying(100)
		entity_id: uuid
		version: integer <<DEFAULT>>
		changed_at: timestamp with time zone <<DEFAULT>>
		changed_by: uuid <<FK,NULLABLE>>
		change_type: character varying(20)
		data_snapshot: jsonb
	}

	entity "task_changes" {
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		entity_type: character varying(100) <<CHECK>>
		entity_id: uuid
		version: integer <<DEFAULT>>
		changed_at: timestamp with time zone <<DEFAULT>>
		changed_by: uuid <<NULLABLE>>
		change_type: character varying(20)
		data_snapshot: jsonb
		project_id: uuid
		task_number: integer
		status_before: core.task_status <<NULLABLE>>
		status_after: core.task_status <<NULLABLE>>
	}

	entity "project_changes" {
		id: bigint <<AUTO_INCREMENT,DEFAULT>>
		entity_type: character varying(100) <<CHECK>>
		entity_id: uuid
		version: integer <<DEFAULT>>
		changed_at: timestamp with time zone <<DEFAULT>>
		changed_by: uuid <<NULLABLE>>
		change_type: character varying(20)
		data_snapshot: jsonb
		organization_id: uuid
		status_before: core.project_status <<NULLABLE>>
		status_after: core.project_status <<NULLABLE>>
	}

	entity "access_log" {
		**id: bigint** <<AUTO_INCREMENT,DEFAULT>>
		--
		event_time: timestamp with time zone <<DEFAULT>>
		user_id: uuid <<FK,NULLABLE>>
		session_id: uuid <<NULLABLE>>
		client_ip: inet
		client_ip_network: cidr <<NULLABLE>>
		request_method: character varying(10)
		request_path: text
		request_query: jsonb <<NULLABLE>>
		response_status: smallint
		response_time_ms: integer
		geo_country: character(2) <<NULLABLE>>
		geo_region: character varying(100) <<NULLABLE>>
		geo_city: character varying(100) <<NULLABLE>>
		geo_coordinates: point <<NULLABLE>>
		risk_score: smallint <<NULLABLE>>
		risk_factors: ARRAY <<NULLABLE>>
		metadata: jsonb <<DEFAULT>>
	}

}

core.organizations ||--o{ auth.user_roles

permissions ||--|{ role_permissions

roles ||--o{ roles
roles ||--|{ role_permissions
roles ||--|{ user_roles

users ||--|{ user_mfa
users ||--o{ role_permissions
users ||--|{ user_roles
users ||--o{ user_roles
users ||--|{ sessions

comments ||--o{ comments

organizations ||--|{ organization_members
organizations ||--|{ projects
organizations ||--|{ resource_bookings

projects ||--|{ tasks

tasks ||--o{ tasks
tasks ||--|{ task_dependencies
tasks ||--|{ task_dependencies
tasks ||--|{ time_entries

auth.users ||--o{ core.organizations
auth.users ||--|{ core.organization_members
auth.users ||--o{ core.organization_members
auth.users ||--o{ core.projects
auth.users ||--o{ core.projects
auth.users ||--o{ core.tasks
auth.users ||--o{ core.tasks
auth.users ||--o{ core.task_dependencies
auth.users ||--|{ core.time_entries
auth.users ||--|{ core.resource_bookings
auth.users ||--|{ core.comments

auth.users ||--|{ analytics.user_activity_summary

auth.users ||--o{ audit.entity_changes
auth.users ||--o{ audit.access_log

@enduml
